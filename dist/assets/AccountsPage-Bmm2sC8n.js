import{j as e,r}from"./vendor-react-gZ_13g0c.js";import{c as Fe,m as ns,B as c,g as as,d as D,I as Y,e as De,f as rs,h as is,s as os,t as f,i as cs,j as ls,k as ds,l as us,n as ms,o as hs,p as ps,q as xs,b as Te,r as _e,v as Oe,C as gs,w as fs,P as js,x as vs,y as Ss}from"./index-CIGRwQmS.js";import{u as Ns,b as ys,c as B,d as ws,g as Cs,e as bs,f as As}from"./vendor-tanstack-Cuc2T00b.js";import{B as xe,I as $,D as K,a as q,b as Q,c as U,d as W,L,e as M,P as ks}from"./label-KQfz7kZ3.js";import{C as Re}from"./checkbox-DN3m8vkQ.js";import{i as zs,j as Is,k as he,l as ge,m as Es,d as Ps,n as Fs,o as Ds,p as ne,q as Ae,r as Me,s as Ts,t as _s,u as Os,v as Rs,w as ke,x as Ms,y as $s,z as Ve,A as Be,g as Ls,B as Hs,C as Vs,D as Bs,E as Ks}from"./vendor-icons-DG3TFKsj.js";import{T as qs,a as Qs,b as be,c as Us,d as Ws,e as $e}from"./table-BjApHs0I.js";import{T as Gs,E as Zs}from"./EmptyState-GHdAjirr.js";import{i as Js,l as Xs,o as Ys,s as et}from"./vendor-tauri-_1WXYKVx.js";import{v as Le,a as He}from"./validation-BBkudM17.js";import{S as Ke,a as qe,b as Qe,c as Ue,d as ae}from"./select-CLklKb2E.js";import{S as st}from"./scroll-area-DAmzG-Zv.js";import{u as tt}from"./vendor-router-g0d7T5Xz.js";const nt={stopped:{variant:"secondary",pulse:!1,pulseColor:""},starting:{variant:"outline",pulse:!0,pulseColor:"bg-info/50"},running:{variant:"default",pulse:!0,pulseColor:"bg-success/50"},stopping:{variant:"outline",pulse:!0,pulseColor:"bg-warning/50"},reconnecting:{variant:"outline",pulse:!0,pulseColor:"bg-warning/50"},error:{variant:"destructive",pulse:!0,pulseColor:"bg-destructive/50"}};function at({status:a,className:d}){const j=nt[a];return e.jsxs("div",{className:Fe("relative inline-flex",d),children:[j.pulse&&e.jsx(ns.span,{className:Fe("absolute inset-0 rounded-full",j.pulseColor),initial:{scale:1,opacity:.5},animate:{scale:1.5,opacity:0},transition:{duration:1.5,repeat:1/0,ease:"easeOut"}}),e.jsx(xe,{variant:j.variant,className:"relative",children:a})]})}function rt({table:a,accounts:d,selectedCount:j,globalFilter:n,setGlobalFilter:x,startAllPending:l,stopAllPending:i,startSelectedPending:y,stopSelectedPending:g,onStartAll:S,onStopAll:P,onStartSelected:u,onStopSelected:I}){const A=d.filter(C=>C.status==="stopped"||C.status==="error").length,m=d.filter(C=>C.status==="running").length;return e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>a.toggleAllRowsSelected(!0),children:[e.jsx(zs,{className:"size-4 mr-1"}),"Select All"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>a.toggleAllRowsSelected(!1),children:[e.jsx(Is,{className:"size-4 mr-1"}),"Clear"]}),e.jsx("div",{className:"h-4 w-px bg-border mx-2"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:S,disabled:l||A===0,children:[e.jsx(he,{className:"size-4 mr-1"}),"Start All"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:P,disabled:i||m===0,children:[e.jsx(ge,{className:"size-4 mr-1"}),"Stop All"]}),j>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-px bg-border mx-2"}),e.jsxs(c,{size:"sm",onClick:u,disabled:y,children:[e.jsx(he,{className:"size-4 mr-1"}),"Start Selected (",j,")"]}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:I,disabled:g,children:[e.jsx(ge,{className:"size-4 mr-1"}),"Stop Selected (",j,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-2.5 top-2.5 size-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search accounts...","aria-label":"Search accounts",value:n,onChange:C=>x(C.target.value),className:"pl-8 w-64"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.getFilteredRowModel().rows.length===d.length?`${d.length} account${d.length!==1?"s":""}`:`${a.getFilteredRowModel().rows.length} of ${d.length} accounts`})]})]})}function it({table:a,columns:d,accounts:j,isLoading:n,onCreate:x}){return n?e.jsx(Gs,{rows:5,columns:7}):j.length===0?e.jsx(Zs,{icon:e.jsx(Ps,{className:"h-8 w-8 text-muted-foreground"}),title:"No accounts yet",description:"Add your first Telegram account to start automating Werewolf games.",action:{label:"Create Account",onClick:x}}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(qs,{style:{width:a.getCenterTotalSize()},children:[e.jsx(Qs,{children:a.getHeaderGroups().map(l=>e.jsx(be,{children:l.headers.map(i=>{const y=i.column.getCanSort(),g=i.column.getCanResize(),S=i.column.getIsSorted();return e.jsxs(Us,{style:{width:i.getSize()},className:`relative ${y?"cursor-pointer select-none hover:bg-muted/50":""}`,onClick:y?i.column.getToggleSortingHandler():void 0,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[i.isPlaceholder?null:typeof i.column.columnDef.header=="function"?i.column.columnDef.header(i.getContext()):i.column.columnDef.header??null,S==="asc"&&e.jsx(Fs,{className:"h-3 w-3"}),S==="desc"&&e.jsx(Ds,{className:"h-3 w-3"})]}),g&&e.jsx("div",{onMouseDown:i.getResizeHandler(),onTouchStart:i.getResizeHandler(),"aria-label":"Resize column",className:`absolute right-0 top-0 h-full w-1 cursor-col-resize select-none touch-none bg-transparent hover:bg-primary/50 ${i.column.getIsResizing()?"bg-primary":""}`,style:{userSelect:"none"}})]},i.id)})},l.id))}),e.jsx(Ws,{children:a.getRowModel().rows.length===0?e.jsx(be,{children:e.jsx($e,{colSpan:d.length,className:"h-24 text-center",children:"No results found."})}):a.getRowModel().rows.map(l=>e.jsx(be,{"data-state":l.getIsSelected()?"selected":void 0,className:"hover:shadow-sm",children:l.getVisibleCells().map(i=>e.jsx($e,{style:{width:i.column.getSize()},children:typeof i.column.columnDef.cell=="function"?i.column.columnDef.cell(i.getContext()):i.column.columnDef.cell??null},i.id))},l.id))})]})})}async function ee(a,d){try{return await Js(a,d)}catch(j){const n=as(j);if(n){const x=n.details?`
${n.details}`:"",l=n.code?`[${n.code}] `:"";throw new Error(`${l}${n.message??"Unknown error"}${x}`)}throw new Error(D(j))}}async function ot(a,d){return ee(Y.loginStart,{apiId:a,apiHash:d})}async function ct(a){return ee(Y.loginGetState,{token:a})}async function lt(a,d){return ee(Y.loginSendPhone,{token:a,phone:d})}async function dt(a,d){return ee(Y.loginSendCode,{token:a,code:d})}async function ut(a,d){return ee(Y.loginSendPassword,{token:a,password:d})}async function mt(a,d,j,n){return ee(Y.loginComplete,{token:a,accountName:d,apiIdOverride:j,apiHashOverride:n})}async function ht(a){return ee(Y.loginCancel,{token:a})}function pt({open:a,onOpenChange:d,onSuccess:j}){const[n,x]=r.useState("init"),[l,i]=r.useState(!1),[y,g]=r.useState(null),[S,P]=r.useState(null),[u,I]=r.useState(""),[A,m]=r.useState(""),[C,k]=r.useState(""),[E,w]=r.useState(""),[h,N]=r.useState(""),[v,b]=r.useState(""),[O,G]=r.useState(""),[H,re]=r.useState(null),[R,se]=r.useState(),[Z,V]=r.useState(),[fe,J]=r.useState(!1);r.useEffect(()=>{a&&(x("init"),i(!1),g(null),P(null),I(""),m(""),k(""),w(""),N(""),b(""),G(""),re(null),se(void 0),V(void 0),J(!1),pe())},[a]),r.useEffect(()=>{if(!S||n==="success"||n==="error")return;const t=setInterval(async()=>{try{const p=await ct(S);_(p)}catch(p){De.logError(p,"Error polling login state",{source:"LoginWizard"})}},1e3);return()=>clearInterval(t)},[S,n]);const pe=async()=>{i(!0),g(null);try{const t=await rs(h?parseInt(h):null,v||null);if(!t.can_proceed){const F=t.errors.filter(z=>z.is_blocking).map(z=>`â€¢ ${z.message}${z.details?`
  ${z.details}`:""}`).join(`

`);g(F||"Cannot start login due to configuration issues."),x("error"),i(!1);return}const p=await ot(h?parseInt(h):void 0,v||void 0);P(p.token),_(p.state)}catch(t){g(t instanceof Error?t.message:String(t)),x("error")}finally{i(!1)}},_=t=>{switch(t.state){case"waiting_phone_number":x("phone");break;case"waiting_code":x("code");break;case"waiting_password":G(t.password_hint||""),x("password");break;case"ready":re({userId:t.user_id,firstName:t.first_name,lastName:t.last_name,phone:t.phone}),n!=="name"&&!fe&&w(t.first_name||"My Account"),x("name");break;case"error":g(t.message),x("error");break}},je=t=>{if(I(t),t.trim()){const p=Le(t);se(p.error)}else se(void 0)},ie=t=>{if(w(t),J(!0),t.trim()){const p=He(t);V(p.error)}else V(void 0)},ve=async()=>{if(!S||!u.trim())return;const t=Le(u);if(!t.valid){se(t.error);return}i(!0),g(null);try{const p=await lt(S,u.trim());_(p)}catch(p){g(p instanceof Error?p.message:String(p))}finally{i(!1)}},Se=async()=>{if(!(!S||!A.trim())){i(!0),g(null);try{const t=await dt(S,A.trim());_(t)}catch(t){g(t instanceof Error?t.message:String(t))}finally{i(!1)}}},Ne=async()=>{if(!(!S||!C)){i(!0),g(null);try{const t=await ut(S,C);_(t)}catch(t){g(t instanceof Error?t.message:String(t))}finally{i(!1)}}},ye=async()=>{if(!S||!E.trim())return;const t=He(E);if(!t.valid){V(t.error);return}i(!0),g(null);try{if(await is(E.trim())){V("An account with this name already exists"),i(!1);return}await mt(S,E.trim(),h?parseInt(h):null,v||null),x("success"),setTimeout(()=>{j(),d(!1)},1500)}catch(p){g(p instanceof Error?p.message:String(p)),x("error")}finally{i(!1)}},oe=async()=>{if(S)try{await ht(S)}catch(t){De.logError(t,"Error canceling login",{source:"LoginWizard"})}i(!1),d(!1)},X=()=>{const t=[{key:"phone",label:"Phone",icon:Ts},{key:"code",label:"Code",icon:_s},{key:"password",label:"2FA",icon:Os,optional:!0},{key:"name",label:"Name",icon:Rs}],p=t.findIndex(F=>F.key===n);return e.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:t.map((F,z)=>{const ce=F.icon,le=F.key===n,de=p>z||n==="success",ue=F.optional&&n==="name"&&z===2;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${le?"bg-primary text-primary-foreground":de||ue?"bg-success text-success-foreground":"bg-muted text-muted-foreground"}`,children:de||ue?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(ce,{className:"w-4 h-4"})}),z<t.length-1&&e.jsx("div",{className:`w-8 h-0.5 ${p>z||n==="success"?"bg-success":"bg-muted"}`})]},F.key)})})},we=()=>n==="init"||l&&n!=="phone"&&n!=="code"&&n!=="password"&&n!=="name"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(ne,{className:"w-8 h-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Initializing Telethon..."})]}):n==="error"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Ae,{className:"w-12 h-12 text-destructive mb-4"}),e.jsx("p",{className:"text-destructive font-medium mb-2",children:"Login Failed"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:y})]}):n==="success"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Me,{className:"w-12 h-12 text-success mb-4"}),e.jsx("p",{className:"text-success font-medium",children:"Account Created!"})]}):n==="phone"?e.jsxs("div",{className:"space-y-4",children:[X(),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"phone",children:"Phone Number"}),e.jsx($,{id:"phone",type:"tel",value:u,onChange:t=>je(t.target.value),placeholder:"+1234567890",disabled:l,className:R?"border-destructive":""}),R?e.jsx("p",{className:"text-xs text-destructive",children:R}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter your phone number with country code"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"apiIdOverride",children:"API ID Override (optional)"}),e.jsx($,{id:"apiIdOverride",type:"number",value:h,onChange:t=>N(t.target.value),placeholder:"Use global default",disabled:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"apiHashOverride",children:"API Hash Override (optional)"}),e.jsx($,{id:"apiHashOverride",type:"password",value:v,onChange:t=>b(t.target.value),placeholder:"Use global default",disabled:l})]})]}),y&&e.jsx("p",{className:"text-sm text-destructive",children:y})]}):n==="code"?e.jsxs("div",{className:"space-y-4",children:[X(),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"code",children:"Verification Code"}),e.jsx($,{id:"code",type:"text",value:A,onChange:t=>m(t.target.value),placeholder:"12345",disabled:l,maxLength:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the code sent to your Telegram app"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"h-3 w-3 animate-spin"}),"Waiting for code..."]})]}),y&&e.jsx("p",{className:"text-sm text-destructive",children:y})]}):n==="password"?e.jsxs("div",{className:"space-y-4",children:[X(),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"password",children:"Two-Factor Authentication"}),e.jsx($,{id:"password",type:"password",value:C,onChange:t=>k(t.target.value),placeholder:"Enter your 2FA password",disabled:l}),O&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Hint: ",O]})]}),y&&e.jsx("p",{className:"text-sm text-destructive",children:y})]}):n==="name"?e.jsxs("div",{className:"space-y-4",children:[X(),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Logged in as:"}),e.jsxs("p",{className:"text-lg",children:[H?.firstName," ",H?.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H?.phone})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"accountName",children:"Account Name"}),e.jsx($,{id:"accountName",value:E,onChange:t=>ie(t.target.value),placeholder:"My Account",disabled:l,className:Z?"border-destructive":"",maxLength:100}),Z?e.jsx("p",{className:"text-xs text-destructive",children:Z}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Give this account a name for easy identification"})]}),y&&e.jsx("p",{className:"text-sm text-destructive",children:y})]}):null,te=()=>n==="init"||n==="success"?null:n==="error"?e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:oe,children:"Close"}),e.jsx(c,{onClick:pe,children:"Try Again"})]}):e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:oe,children:"Cancel"}),n==="phone"&&e.jsxs(c,{onClick:ve,disabled:l||!u.trim()||!!R,children:[l?e.jsx(ne,{className:"w-4 h-4 animate-spin mr-2"}):null,"Send Code"]}),n==="code"&&e.jsxs(c,{onClick:Se,disabled:l||!A.trim(),children:[l?e.jsx(ne,{className:"w-4 h-4 animate-spin mr-2"}):null,"Verify"]}),n==="password"&&e.jsxs(c,{onClick:Ne,disabled:l||!C,children:[l?e.jsx(ne,{className:"w-4 h-4 animate-spin mr-2"}):null,"Submit"]}),n==="name"&&e.jsxs(c,{onClick:ye,disabled:l||!E.trim()||!!Z,children:[l?e.jsx(ne,{className:"w-4 h-4 animate-spin mr-2"}):null,"Create Account"]})]});return e.jsx(K,{open:a,onOpenChange:t=>{t||oe()},children:e.jsxs(q,{className:"sm:max-w-md",hideClose:!1,children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Add Telegram Account"}),e.jsxs(W,{children:[n==="phone"&&"Enter your phone number to receive a verification code",n==="code"&&"Check your Telegram app for the verification code",n==="password"&&"Enter your two-factor authentication password",n==="name"&&"Choose a name for this account",n==="init"&&"Connecting to Telegram...",n==="error"&&"Something went wrong",n==="success"&&"Account created successfully"]})]}),we(),te()]})})}function xt(){const a=Ns(),d=ys({queryKey:["accounts"],queryFn:xs}),j=B({mutationFn:ps,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Account created")},onError:u=>{f.error("Failed to create account",{description:D(u)})}}),n=B({mutationFn:hs,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Account deleted")},onError:u=>{f.error("Failed to delete account",{description:D(u)})}}),x=B({mutationFn:ms,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Account started")},onError:u=>{f.error("Failed to start account",{description:D(u)})}}),l=B({mutationFn:us,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Account stopped")},onError:u=>{f.error("Failed to stop account",{description:D(u)})}}),i=B({mutationFn:ds,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Started all accounts")},onError:u=>{f.error("Failed to start all accounts",{description:D(u)})}}),y=B({mutationFn:ls,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Stopped all accounts")},onError:u=>{f.error("Failed to stop all accounts",{description:D(u)})}}),g=B({mutationFn:cs,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Started selected accounts")},onError:u=>{f.error("Failed to start selected accounts",{description:D(u)})}}),S=B({mutationFn:os,onSuccess:()=>{a.invalidateQueries({queryKey:["accounts"]}),f.success("Stopped selected accounts")},onError:u=>{f.error("Failed to stop selected accounts",{description:D(u)})}}),P=r.useMemo(()=>{const u=d.data??[],I=u.filter(m=>m.status==="running"),A=u.filter(m=>m.status==="stopped");return{running:I,stopped:A}},[d.data]);return{accountsQuery:d,createMutation:j,deleteMutation:n,startMutation:x,stopMutation:l,startAllMutation:i,stopAllMutation:y,startSelectedMutation:g,stopSelectedMutation:S,selectedSummary:P}}const gt={status:e.jsx(he,{className:"size-4"}),phase:e.jsx(Hs,{className:"size-4"}),action:e.jsx(Ls,{className:"size-4"}),join:e.jsx(Be,{className:"size-4"}),error:e.jsx(Ae,{className:"size-4"}),warn:e.jsx(Ae,{className:"size-4"}),info:e.jsx(ke,{className:"size-4"})},ft={status:"bg-info/10 text-info",phase:"bg-primary/10 text-primary",action:"bg-success/10 text-success",join:"bg-warning/10 text-warning",error:"bg-destructive/10 text-destructive",warn:"bg-warning/10 text-warning",info:"bg-muted/10 text-muted-foreground"};function jt(a){return a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function vt(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function St({maxItems:a=100,className:d="",collapsible:j=!1,defaultCollapsed:n=!1}){const[x,l]=r.useState([]),[i,y]=r.useState(n),[g,S]=r.useState("warn"),P=r.useRef(null),u=m=>{l(C=>[{...m,id:vt(),timestamp:new Date},...C].slice(0,a))};r.useEffect(()=>{const m=[];let C=!1;const k=async(w,h)=>{const N=await Xs(w,h);if(C){N();return}m.push(N)};return(async()=>(await k("account-status",w=>{const{account_id:h,account_name:N,status:v,message:b}=w.payload;if(v==="starting"||v==="stopping")return;const O={running:"Started",stopped:"Stopped",error:"Error",reconnecting:"Reconnecting"};u({type:v==="error"?"error":"status",accountId:h,accountName:N,title:`${N||`Account ${h}`} ${O[v]||v}`,description:b||void 0})}),await k("phase-detected",w=>{const{account_id:h,account_name:N,phase_name:v}=w.payload;u({type:"phase",accountId:h,accountName:N,title:`Phase: ${v}`,description:`Detected for ${N}`})}),await k("action-detected",w=>{const{account_id:h,account_name:N,action_name:v,target:b}=w.payload;u({type:"action",accountId:h,accountName:N,title:`Action: ${v}`,description:b?`Target: ${b}`:`Executed for ${N}`})}),await k("join-attempt",w=>{const{account_id:h,account_name:N,attempt:v,success:b,message:O}=w.payload;u({type:"join",accountId:h,accountName:N,title:`Join Attempt #${v}`,description:b?"Joined successfully":O||"Attempting to join..."})}),await k("account-log",w=>{const{account_name:h,level:N,message:v}=w.payload;if(N==="debug")return;const b=N==="warn"?"warn":N==="error"?"error":"info";u({type:b==="error"?"error":b==="warn"?"warn":"info",logLevel:b,accountName:h,title:`${b.toUpperCase()}: ${h}`,description:v}),b==="warn"&&v&&(v.includes("FLOOD_WAIT")||v.includes("SLOWMODE_WAIT"))&&f.warning("Telegram limit reached",{description:v})})))(),()=>{C=!0,m.forEach(w=>w())}},[a]);const I=()=>{l([])},A=x.filter(m=>!m.logLevel||g==="all"?!0:m.logLevel===g);return j&&i?e.jsx(Te,{className:d,children:e.jsx(_e,{className:"py-3 cursor-pointer",onClick:()=>y(!1),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Oe,{className:"text-sm flex items-center gap-2",children:[e.jsx(ke,{className:"size-4"}),"Activity Feed",x.length>0&&e.jsx(xe,{variant:"secondary",className:"ml-2",children:x.length})]}),e.jsx(Ms,{className:"size-4 text-muted-foreground"})]})})}):e.jsxs(Te,{className:d,children:[e.jsx(_e,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Oe,{className:`text-sm flex items-center gap-2 ${j?"cursor-pointer":""}`,onClick:j?()=>y(!0):void 0,children:[e.jsx(ke,{className:"size-4"}),"Activity Feed",j&&e.jsx($s,{className:"size-4 text-muted-foreground ml-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"Log level"}),e.jsxs(Ke,{value:g,onValueChange:m=>S(m),children:[e.jsx(qe,{size:"sm",className:"w-28",children:e.jsx(Qe,{})}),e.jsxs(Ue,{children:[e.jsx(ae,{value:"all",children:"All"}),e.jsx(ae,{value:"error",children:"Errors"}),e.jsx(ae,{value:"warn",children:"Warnings"}),e.jsx(ae,{value:"info",children:"Info"})]})]})]}),x.length>0&&e.jsx(c,{variant:"ghost",size:"icon-sm",onClick:I,title:"Clear activity feed",children:e.jsx(Ve,{className:"size-4"})})]})]})}),e.jsx(gs,{className:"p-0",children:e.jsx(st,{className:"h-64",ref:P,children:A.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground text-sm py-8",children:x.length===0?"No activity yet":"No activity matching filter"}):e.jsx("div",{className:"space-y-1 p-3 pt-0",children:A.map(m=>e.jsxs("div",{className:"flex items-start gap-3 py-2 border-b border-border/50 last:border-0",children:[e.jsx("div",{className:`p-1.5 rounded-md ${ft[m.type]}`,children:gt[m.type]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:m.title}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:jt(m.timestamp)})]}),m.description&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:m.description})]})]},m.id))})})})]})}function Tt(){const a=tt(),[d,j]=r.useState([{id:"account_name",desc:!1}]),[n,x]=r.useState({}),[l,i]=r.useState({}),[y,g]=r.useState(""),[S,P]=r.useState(!1),[u,I]=r.useState(!1),[A,m]=r.useState(null),[C,k]=r.useState(!1),[E,w]=r.useState(""),[h,N]=r.useState(""),[v,b]=r.useState(!1),[O,G]=r.useState(!1),[H,re]=r.useState(null),[R,se]=r.useState("zip"),[Z,V]=r.useState(!1),[fe,J]=r.useState(!1),[pe,_]=r.useState(!1),[je,ie]=r.useState(!1),[ve,Se]=r.useState(null),[Ne,ye]=r.useState(""),[oe,X]=r.useState([]),[we,te]=r.useState(!1),{accountsQuery:t,deleteMutation:p,startMutation:F,stopMutation:z,startAllMutation:ce,stopAllMutation:le,startSelectedMutation:de,stopSelectedMutation:ue}=xt(),me=t.data??[],We=t.isLoading,ze=r.useCallback(s=>e.jsx(at,{status:s}),[]),Ie=r.useMemo(()=>[{id:"select",header:({table:s})=>e.jsx(Re,{checked:s.getIsAllPageRowsSelected(),onCheckedChange:o=>s.toggleAllPageRowsSelected(!!o),"aria-label":"Select all"}),cell:({row:s})=>e.jsx(Re,{checked:s.getIsSelected(),onCheckedChange:o=>s.toggleSelected(!!o),"aria-label":"Select row"}),size:40,enableSorting:!1,enableResizing:!1},{accessorKey:"account_name",header:"Name",size:150,minSize:100,cell:({row:s})=>e.jsx("span",{className:"font-medium",children:s.getValue("account_name")})},{accessorKey:"phone",header:"Phone",size:130,minSize:100,cell:({row:s})=>s.getValue("phone")||"-"},{accessorKey:"user_id",header:"User ID",size:120,minSize:80,cell:({row:s})=>s.getValue("user_id")||"-"},{accessorKey:"status",header:"Status",size:100,minSize:80,cell:({row:s})=>ze(s.getValue("status"))},{accessorKey:"last_seen_at",header:"Last Seen",size:180,minSize:120,cell:({row:s})=>{const o=s.getValue("last_seen_at");return o?new Date(o).toLocaleString():"-"}},{id:"actions",header:()=>e.jsx("span",{className:"sr-only",children:"Actions"}),size:160,minSize:140,enableSorting:!1,enableResizing:!1,cell:({row:s})=>{const o=s.original;return e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[o.status==="stopped"||o.status==="error"?e.jsx(c,{variant:"ghost",size:"icon-sm",title:"Start","aria-label":"Start account",onClick:()=>Je(o),disabled:F.isPending,children:e.jsx(he,{className:"size-4"})}):e.jsx(c,{variant:"ghost",size:"icon-sm",title:"Stop","aria-label":"Stop account",onClick:()=>z.mutate(o.id),disabled:z.isPending,children:e.jsx(ge,{className:"size-4"})}),e.jsx(c,{variant:"ghost",size:"icon-sm",onClick:()=>a(`/accounts/${o.id}/edit`),title:"Edit","aria-label":"Edit account",children:e.jsx(Vs,{className:"size-4"})}),e.jsx(c,{variant:"ghost",size:"icon-sm",onClick:()=>ss(o),title:"Export","aria-label":"Export account",children:e.jsx(Bs,{className:"size-4"})}),e.jsx(c,{variant:"ghost",size:"icon-sm",onClick:()=>{m(o),I(!0)},title:"Delete","aria-label":"Delete account",children:e.jsx(Ve,{className:"size-4"})})]})}}],[ze,a,F,z]),Ee=ws({data:me,columns:Ie,state:{sorting:d,columnSizing:n,rowSelection:l,globalFilter:y},enableRowSelection:!0,enableColumnResizing:!0,columnResizeMode:"onChange",onSortingChange:j,onColumnSizingChange:x,onRowSelectionChange:i,onGlobalFilterChange:g,getCoreRowModel:As(),getSortedRowModel:bs(),getFilteredRowModel:Cs(),getRowId:s=>String(s.id)}),Ce=r.useMemo(()=>Object.keys(l).map(Number),[l]),Ge=Ce.length,Ze=()=>{t.refetch()},Je=async s=>{try{const o=await fs(s.id);if(!o.can_proceed){Se(o),ye(s.account_name),ie(!0);return}o.errors.length>0&&o.errors.forEach(T=>{f.warning(T.message,{description:T.details||void 0})}),F.mutate(s.id)}catch(o){f.error("Failed to validate account",{description:D(o)})}},Xe=()=>{A&&p.mutate(A.id,{onSuccess:()=>{f.success("Account deleted",{description:`${A.account_name} has been removed.`})},onSettled:()=>{I(!1),m(null)}})},Pe=async s=>{const o=await Ys({title:"Select session file or folder",directory:s,multiple:!1,filters:s?void 0:[{name:"Session Bundle",extensions:["zip"]},{name:"All Files",extensions:["*"]}]});if(o){w(o);const T=o.split(/[/\\]/),ts=T[T.length-1]||"";h||N(ts.replace(/_session$/,""))}},Ye=async()=>{if(!(!E||!h)){b(!0);try{const s=await vs(E,h);s.success?(f.success("Account imported",{description:s.message}),t.refetch(),k(!1),w(""),N("")):f.error("Import failed",{description:s.message})}catch(s){f.error("Import failed",{description:D(s)})}finally{b(!1)}}},es=async()=>{if(!H)return;const s=await et({title:"Export session",defaultPath:`${H.account_name}_session${R==="zip"?".zip":""}`,filters:R==="zip"?[{name:"ZIP Archive",extensions:["zip"]}]:[]});if(s){V(!0);try{const o=await Ss(H.id,s,R);o.success?(f.success("Account exported",{description:o.message}),G(!1),re(null)):f.error("Export failed",{description:o.message})}catch(o){f.error("Export failed",{description:D(o)})}finally{V(!1)}}},ss=s=>{re(s),G(!0)};return e.jsxs(js,{className:"min-h-screen flex flex-col",children:[e.jsx(ks,{title:"Accounts",description:"Manage Telegram accounts and sessions",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{size:"sm",onClick:()=>P(!0),children:[e.jsx(Be,{className:"size-4 mr-1"}),"Create"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>k(!0),children:[e.jsx(Ks,{className:"size-4 mr-1"}),"Import"]})]})}),e.jsx(pt,{open:S,onOpenChange:P,onSuccess:Ze}),e.jsxs("main",{className:"flex-1 p-6 w-full max-w-6xl mx-auto",children:[e.jsx(rt,{table:Ee,accounts:me,selectedCount:Ge,globalFilter:y,setGlobalFilter:g,startAllPending:ce.isPending,stopAllPending:le.isPending,startSelectedPending:de.isPending,stopSelectedPending:ue.isPending,onStartAll:()=>J(!0),onStopAll:()=>_(!0),onStartSelected:()=>de.mutate(Ce,{onSuccess:s=>{s.filter(T=>!T.started).length>0&&(X(s),te(!0))}}),onStopSelected:()=>ue.mutate(Ce)}),e.jsx(it,{table:Ee,columns:Ie,accounts:me,isLoading:We,onCreate:()=>P(!0)}),e.jsx(K,{open:u,onOpenChange:I,children:e.jsxs(q,{children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Delete Account"}),e.jsxs(W,{children:['Are you sure you want to delete "',A?.account_name,'"? This will remove the database record and session files. This action cannot be undone.']})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>I(!1),children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:Xe,disabled:p.isPending,children:"Delete"})]})]})}),e.jsx(K,{open:C,onOpenChange:k,children:e.jsxs(q,{children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Import Session"}),e.jsx(W,{children:"Import an existing Telethon session from a folder or ZIP file."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"import-path",children:"Session Path"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{id:"import-path",value:E,onChange:s=>w(s.target.value),placeholder:"Select session folder or file...",readOnly:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>Pe(!0),children:"Browse Folder"}),e.jsx(c,{variant:"outline",onClick:()=>Pe(!1),children:"Browse ZIP"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"import-name",children:"Account Name"}),e.jsx($,{id:"import-name",value:h,onChange:s=>N(s.target.value),placeholder:"Enter a name for this account"})]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(c,{onClick:Ye,disabled:!E||!h||v,children:v?"Importing...":"Import"})]})]})}),e.jsx(K,{open:O,onOpenChange:G,children:e.jsxs(q,{children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Export Session"}),e.jsxs(W,{children:['Export "',H?.account_name,'" session for backup or transfer.']})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"export-format",children:"Export Format"}),e.jsxs(Ke,{value:R,onValueChange:s=>se(s),children:[e.jsx(qe,{children:e.jsx(Qe,{})}),e.jsxs(Ue,{children:[e.jsx(ae,{value:"zip",children:"ZIP Archive (recommended)"}),e.jsx(ae,{value:"folder",children:"Raw Folder"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ZIP is recommended for sharing or backup. Raw folder copies all session files directly."})]})}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>G(!1),children:"Cancel"}),e.jsx(c,{onClick:es,disabled:Z,children:Z?"Exporting...":"Export"})]})]})}),e.jsx(K,{open:fe,onOpenChange:J,children:e.jsxs(q,{children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Start All Accounts"}),e.jsxs(W,{children:["Are you sure you want to start all stopped accounts? This will start ",me.filter(s=>s.status==="stopped"||s.status==="error").length," account(s)."]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),e.jsxs(c,{onClick:()=>{ce.mutate(void 0,{onSuccess:s=>{s.filter(T=>!T.started).length>0&&(X(s),te(!0))}}),J(!1)},disabled:ce.isPending,children:[e.jsx(he,{className:"size-4 mr-1"}),"Start All"]})]})]})}),e.jsx(K,{open:pe,onOpenChange:_,children:e.jsxs(q,{children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Stop All Accounts"}),e.jsxs(W,{children:["Are you sure you want to stop all running accounts? This will stop ",me.filter(s=>s.status==="running").length," account(s)."]})]}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsxs(c,{variant:"destructive",onClick:()=>{le.mutate(),_(!1)},disabled:le.isPending,children:[e.jsx(ge,{className:"size-4 mr-1"}),"Stop All"]})]})]})}),e.jsx(K,{open:je,onOpenChange:ie,children:e.jsxs(q,{className:"max-w-lg",children:[e.jsxs(Q,{children:[e.jsx(U,{className:"text-destructive",children:"Cannot Start Account"}),e.jsxs(W,{children:['"',Ne,'" cannot be started due to the following issues:']})]}),e.jsx("div",{className:"space-y-3 py-4 max-h-80 overflow-y-auto",children:ve?.errors.map((s,o)=>e.jsx("div",{className:`p-3 rounded-lg border ${s.is_blocking?"bg-destructive/10 border-destructive/30":"bg-warning/10 border-warning/30"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{variant:s.is_blocking?"destructive":"outline",className:"shrink-0",children:s.is_blocking?"Error":"Warning"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.message}),s.details&&e.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap",children:s.details})]})]})},o))}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>ie(!1),children:"Close"}),e.jsx(c,{onClick:()=>a("/settings"),children:"Go to Settings"})]})]})}),e.jsx("div",{className:"mt-6",children:e.jsx(St,{collapsible:!0,defaultCollapsed:!0})}),e.jsx(K,{open:we,onOpenChange:te,children:e.jsxs(q,{className:"max-w-xl",children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Some accounts could not start"}),e.jsx(W,{children:"Review the preflight issues below and resolve them before retrying."})]}),e.jsx("div",{className:"space-y-4 py-2 max-h-80 overflow-y-auto",children:oe.filter(s=>!s.started).map(s=>e.jsxs("div",{className:"rounded-lg border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium",children:s.account_name}),e.jsx(xe,{variant:"destructive",children:"Failed"})]}),e.jsx("div",{className:"space-y-2",children:s.errors.map((o,T)=>e.jsxs("div",{className:`rounded-md border px-3 py-2 text-xs ${o.is_blocking?"bg-destructive/10 border-destructive/30":"bg-warning/10 border-warning/30"}`,children:[e.jsx("p",{className:"font-semibold text-sm",children:o.message}),o.details&&e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:o.details})]},T))})]},s.account_id))}),e.jsxs(M,{children:[e.jsx(c,{variant:"outline",onClick:()=>te(!1),children:"Close"}),e.jsx(c,{onClick:()=>a("/settings"),children:"Go to Settings"})]})]})})]})]})}export{Tt as default};
