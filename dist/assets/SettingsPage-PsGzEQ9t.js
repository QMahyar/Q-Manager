import{r,u as we,j as e}from"./vendor-react-gZ_13g0c.js";import{a6 as Ge,t as I,d as Pe,U as Ke,S as $e,a7 as Oe,Q as Ye,u as Ze,P as Xe,B as N,m as es,r as w,v as B,z as S,C,b as ss}from"./index-CIGRwQmS.js";import{P as Be,L as d,I as g,B as as}from"./label-KQfz7kZ3.js";import{S as Se}from"./switch-Cwk0l8Yd.js";import{S as ts}from"./separator-CHBem1en.js";import{u as De,b as Ce,c as Ue}from"./vendor-tanstack-Cuc2T00b.js";import{S as W,a as G,b as K,c as $,d as m}from"./select-CLklKb2E.js";import{H as q,h as J,R as ns}from"./RegexHelpDialog-CKiLRQxK.js";import{b as O,e as rs,f as is,g as ls,h as ds,i as os,d as _e}from"./validation-BBkudM17.js";import{G as Ie,z as cs,H as ms}from"./vendor-icons-DG3TFKsj.js";import"./vendor-tauri-_1WXYKVx.js";import"./vendor-router-g0d7T5Xz.js";import"./scroll-area-DAmzG-Zv.js";function us(){const u=De(),v=Ce({queryKey:["settings"],queryFn:Oe}),x=Ce({queryKey:["actions"],queryFn:Ye}),j=Ue({mutationFn:Ge,onSuccess:()=>{u.invalidateQueries({queryKey:["settings"]}),I.success("Settings saved",{description:"Your settings have been updated."})},onError:h=>{I.error("Failed to save settings",{description:Pe(h)})}});return{settingsQuery:v,actionsQuery:x,saveMutation:j}}function xs(u){const[v,x]=r.useState({});return r.useEffect(()=>{const j=async()=>{const h={};for(const P of u)try{const F=await $e(P.id);h[P.id]={min:F?.min_seconds??2,max:F?.max_seconds??8}}catch{h[P.id]={min:2,max:8}}x(h)};u.length>0&&j()},[u]),{actionDelays:v,setActionDelays:x}}function hs(){const u=De();return Ue({mutationFn:({actionId:x,min:j,max:h})=>Ke(x,j,h),onSuccess:()=>{u.invalidateQueries({queryKey:["delay-defaults"]})},onError:x=>{I.error("Failed to update delay defaults",{description:Pe(x)})}})}function gs(u){try{return JSON.parse(u)}catch{return[]}}const _=es.create(ss);function Ps(){const[u,v]=r.useState(!1),{theme:x,palette:j,variant:h,setTheme:P,setPalette:F,setVariant:Ae}=Ze(),[Re]=we(),[Fe]=we(),[D,Y]=r.useState(""),[H,Z]=r.useState(""),[U,X]=r.useState(""),[ee,se]=r.useState(""),[A,ae]=r.useState(""),[te,ne]=r.useState(""),[M,re]=r.useState(5),[f,ie]=r.useState(5),[b,k]=r.useState([]),[y,le]=r.useState(""),[T,de]=r.useState(!1),[oe,ce]=r.useState(x),[me,ue]=r.useState(j),[xe,he]=r.useState(h),[He,ge]=r.useState(new Set),[n,l]=r.useState({}),[Me,L]=r.useState({}),{settingsQuery:pe,actionsQuery:ke,saveMutation:z}=us(),o=pe.data,Te=pe.isLoading,E=ke.data??[],{actionDelays:V,setActionDelays:ze}=xs(E),Ee=hs();r.useEffect(()=>{o&&(Y(o.api_id?.toString()||""),Z(o.api_hash||""),X(o.main_bot_user_id?.toString()||""),se(o.main_bot_username||""),ae(o.beta_bot_user_id?.toString()||""),ne(o.beta_bot_username||""),re(o.join_max_attempts_default),ie(o.join_cooldown_seconds_default),k(gs(o.ban_warning_patterns_json)),ce(o.theme_mode??x),ue(o.theme_palette??j),he(o.theme_variant??h))},[o,x,j,h]);const je=s=>{if(!s)return l(t=>({...t,apiId:void 0})),!0;const a=rs(s);return l(t=>({...t,apiId:a.error})),a.valid},ve=s=>{if(!s)return l(t=>({...t,apiHash:void 0})),!0;const a=is(s);return l(t=>({...t,apiHash:a.error})),a.valid},Q=(s,a)=>{if(!s)return l(i=>({...i,[a]:void 0})),!0;const t=ls(s);return l(i=>({...i,[a]:t.error})),t.valid},Ve=()=>{const s=O(M,f);return l(a=>({...a,joinRules:s.error})),s.valid},ye=f<=0?"Cooldown is set to 0 seconds. This may cause rapid join attempts.":f<2?"Cooldown is very low. Consider 2+ seconds to avoid rapid retries.":"",fe=(s,a)=>{if(!s.trim())return l(t=>({...t,newBanPattern:void 0})),!0;if(a){const t=ds(s);return l(i=>({...i,newBanPattern:t.error})),t.valid}return l(t=>({...t,newBanPattern:void 0})),!0},be=()=>{let s=!0;if(D&&(s=je(D)&&s),H&&(s=ve(H)&&s),U&&(s=Q(U,"mainBotUserId")&&s),A&&(s=Q(A,"betaBotUserId")&&s),s=Ve()&&s,!s){I.error("Please fix validation errors before saving");return}const a={api_id:D?parseInt(D):null,api_hash:H||null,main_bot_user_id:U?parseInt(U):null,main_bot_username:ee||null,beta_bot_user_id:A?parseInt(A):null,beta_bot_username:te||null,join_max_attempts_default:M,join_cooldown_seconds_default:f,ban_warning_patterns_json:JSON.stringify(b),theme_mode:oe,theme_palette:me,theme_variant:xe};z.mutate(a,{onSuccess:()=>{v(!1)}})},c=()=>{u||v(!0)},Qe=()=>{if(y.trim()){if(T&&!os(y)){l(s=>({...s,newBanPattern:"Invalid regex pattern"}));return}k([...b,{pattern:y.trim(),is_regex:T,enabled:!0,priority:0}]),le(""),de(!1),l(s=>({...s,newBanPattern:void 0})),c()}},qe=s=>{k(b.filter((a,t)=>t!==s)),c()},Je=s=>{const a=[...b];a[s].enabled=!a[s].enabled,k(a),c()},Ne=(s,a,t)=>{const p={...V[s]||{min:2,max:8},[a]:t};ze(R=>({...R,[s]:p})),ge(R=>new Set(R).add(s));const We=_e(p.min,p.max);L(R=>({...R,[s]:We.error||""}))},Le=async s=>{const a=V[s];if(a){const t=_e(a.min,a.max);if(!t.valid){L(i=>({...i,[s]:t.error||""})),I.error("Invalid delay range",{description:t.error});return}await Ee.mutateAsync({actionId:s,min:a.min,max:a.max}),ge(i=>{const p=new Set(i);return p.delete(s),p}),L(i=>({...i,[s]:""})),I.success("Delay saved")}};return Te?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(Be,{title:"Settings",description:"Global configuration and defaults"}),e.jsx("main",{className:"flex-1 p-6 w-full max-w-3xl mx-auto",children:e.jsx("div",{className:"text-muted-foreground text-center py-12",children:"Loading settings..."})})]}):e.jsxs(Xe,{className:"min-h-screen flex flex-col",children:[e.jsx(Be,{title:"Settings",description:"Global configuration and defaults",children:e.jsxs(N,{onClick:be,disabled:!u||z.isPending,children:[e.jsx(Ie,{className:"size-4 mr-1"}),z.isPending?"Saving...":"Save Changes"]})}),e.jsxs("main",{className:"flex-1 p-6 space-y-6 w-full max-w-3xl mx-auto",children:[e.jsxs(_,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:0},children:[e.jsxs(w,{children:[e.jsx(B,{children:"Theme"}),e.jsx(S,{children:"Choose your preferred color palette and light/dark mode."})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Mode"}),e.jsxs(W,{value:oe,onValueChange:s=>{const a=s;ce(a),P(a),c()},children:[e.jsx(G,{children:e.jsx(K,{})}),e.jsxs($,{children:[e.jsx(m,{value:"system",children:"System"}),e.jsx(m,{value:"light",children:"Light"}),e.jsx(m,{value:"dark",children:"Dark"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Palette"}),e.jsxs(W,{value:me,onValueChange:s=>{const a=s;ue(a),F(a),c()},children:[e.jsx(G,{children:e.jsx(K,{})}),e.jsxs($,{children:[e.jsx(m,{value:"zinc",children:"Zinc"}),e.jsx(m,{value:"slate",children:"Slate"}),e.jsx(m,{value:"gray",children:"Gray"}),e.jsx(m,{value:"stone",children:"Stone"}),e.jsx(m,{value:"sky",children:"Sky"}),e.jsx(m,{value:"indigo",children:"Indigo"}),e.jsx(m,{value:"emerald",children:"Emerald"}),e.jsx(m,{value:"rose",children:"Rose"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{children:"Intensity"}),e.jsxs(W,{value:xe,onValueChange:s=>{const a=s;he(a),Ae(a),c()},children:[e.jsx(G,{children:e.jsx(K,{})}),e.jsxs($,{children:[e.jsx(m,{value:"subtle",children:"Subtle"}),e.jsx(m,{value:"vibrant",children:"Vibrant"}),e.jsx(m,{value:"contrast",children:"High contrast"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1",children:[e.jsx("span",{className:"size-2 rounded-full bg-primary"}),"Primary"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1",children:[e.jsx("span",{className:"size-2 rounded-full bg-success"}),"Success"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1",children:[e.jsx("span",{className:"size-2 rounded-full bg-warning"}),"Warning"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border px-2 py-1",children:[e.jsx("span",{className:"size-2 rounded-full bg-destructive"}),"Destructive"]})]})]})]}),e.jsxs(_,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.08},children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{children:"Telegram API Credentials"}),e.jsx(q,{content:J.apiCredentials})]}),e.jsxs(S,{children:["Get your API ID and Hash from"," ",e.jsx("a",{href:"https://my.telegram.org",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"my.telegram.org"})]})]}),e.jsx(C,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"apiId",children:"API ID"}),e.jsx(g,{id:"apiId",type:"number",value:D,onChange:s=>{Y(s.target.value),je(s.target.value),c()},placeholder:"12345678",className:n.apiId?"border-destructive":""}),n.apiId&&e.jsx("p",{className:"text-xs text-destructive",children:n.apiId})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"apiHash",children:"API Hash"}),e.jsx(g,{id:"apiHash",type:"password",value:H,onChange:s=>{Z(s.target.value),ve(s.target.value),c()},placeholder:"abcdef1234567890...",className:n.apiHash?"border-destructive":""}),n.apiHash&&e.jsx("p",{className:"text-xs text-destructive",children:n.apiHash})]})]})})]}),e.jsxs(_,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.16},children:[e.jsxs(w,{children:[e.jsx(B,{children:"Moderator Bots"}),e.jsx(S,{children:"Configure the Werewolf game moderator bots to monitor"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Main Bot"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"mainBotUserId",children:"User ID"}),e.jsx(g,{id:"mainBotUserId",type:"number",value:U,onChange:s=>{X(s.target.value),Q(s.target.value,"mainBotUserId"),c()},placeholder:"123456789",className:n.mainBotUserId?"border-destructive":""}),n.mainBotUserId&&e.jsx("p",{className:"text-xs text-destructive",children:n.mainBotUserId})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"mainBotUsername",children:"Username (optional)"}),e.jsx(g,{id:"mainBotUsername",value:ee,onChange:s=>{se(s.target.value),c()},placeholder:"@werewolfbot"})]})]})]}),e.jsx(ts,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Beta Bot (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"betaBotUserId",children:"User ID"}),e.jsx(g,{id:"betaBotUserId",type:"number",value:A,onChange:s=>{ae(s.target.value),Q(s.target.value,"betaBotUserId"),c()},placeholder:"987654321",className:n.betaBotUserId?"border-destructive":""}),n.betaBotUserId&&e.jsx("p",{className:"text-xs text-destructive",children:n.betaBotUserId})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"betaBotUsername",children:"Username (optional)"}),e.jsx(g,{id:"betaBotUsername",value:te,onChange:s=>{ne(s.target.value),c()},placeholder:"@werewolfbeta"})]})]})]})]})]}),e.jsxs(_,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.24},children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{children:"Join Rules (Default)"}),e.jsx(q,{content:J.joinRules})]}),e.jsx(S,{children:"Default settings for automatic game joining. Can be overridden per account."})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"joinMaxAttempts",children:"Max Join Attempts"}),e.jsx(g,{id:"joinMaxAttempts",type:"number",min:1,max:100,value:M,onChange:s=>{const a=parseInt(s.target.value)||5;re(a),l(t=>({...t,joinRules:O(a,f).error})),c()},className:n.joinRules?"border-destructive":""})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"joinCooldown",children:"Cooldown (seconds)"}),e.jsx(g,{id:"joinCooldown",type:"number",min:0,max:300,value:f,onChange:s=>{const a=parseInt(s.target.value)||5;ie(a),l(t=>({...t,joinRules:O(M,a).error})),c()},className:n.joinRules?"border-destructive":""})]})]}),n.joinRules&&e.jsx("p",{className:"text-xs text-destructive",children:n.joinRules}),!n.joinRules&&ye&&e.jsx("p",{className:"text-xs text-warning",children:ye})]})]}),E.length>0&&e.jsxs(_,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.32},children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{children:"Default Action Delays"}),e.jsx(q,{content:J.delays})]}),e.jsx(S,{children:"Set the default delay range (in seconds) before clicking for each action. Can be overridden per account in Targets page."})]}),e.jsx(C,{children:Object.keys(V).length===0&&E.length>0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Loading delay settings..."}):e.jsx("div",{className:"space-y-3",ref:Fe,children:E.map(s=>{const a=V[s.id]||{min:2,max:8},t=He.has(s.id),i=Me[s.id];return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${i?"border-destructive":""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-2",children:["(",s.button_type,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Min"}),e.jsx(g,{type:"number",min:0,max:300,className:`w-16 h-8 ${i?"border-destructive":""}`,value:a.min,onChange:p=>Ne(s.id,"min",Number(p.target.value))})]}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Max"}),e.jsx(g,{type:"number",min:0,max:300,className:`w-16 h-8 ${i?"border-destructive":""}`,value:a.max,onChange:p=>Ne(s.id,"max",Number(p.target.value))})]}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"sec"}),t&&e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>Le(s.id),disabled:!!i,children:[e.jsx(Ie,{className:"h-3 w-3 mr-1"}),"Save"]})]})]}),i&&e.jsx("p",{className:"text-xs text-destructive pl-3",children:i})]},s.id)})})})]}),e.jsxs(_,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.32},children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{children:"Ban Warning Patterns"}),e.jsx(q,{content:J.banWarnings})]}),e.jsx(S,{children:"If any of these patterns are detected in messages from the moderator bot, the account will stop trying to join the game. This helps prevent bans."})]}),e.jsxs(C,{className:"space-y-4",children:[b.length>0&&e.jsx("div",{className:"space-y-2",ref:Re,children:b.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{checked:s.enabled,onCheckedChange:()=>Je(a)}),e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:s.pattern}),e.jsx(as,{variant:s.is_regex?"default":"secondary",children:s.is_regex?"Regex":"Text"})]}),e.jsx(N,{variant:"ghost",size:"icon-sm",onClick:()=>qe(a),"aria-label":"Remove ban warning pattern",children:e.jsx(cs,{className:"size-4"})})]},a))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 grid gap-2",children:[e.jsx(d,{htmlFor:"newBanPattern",children:"New Pattern"}),e.jsx(g,{id:"newBanPattern",value:y,onChange:s=>{le(s.target.value),T&&s.target.value.trim()?fe(s.target.value,!0):l(a=>({...a,newBanPattern:void 0}))},placeholder:"Enter ban warning text or regex...",className:`font-mono ${n.newBanPattern?"border-destructive":""}`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border rounded-md",children:[e.jsx(d,{htmlFor:"isRegex",className:"text-sm",children:"Regex"}),e.jsx(ns,{trigger:e.jsx(N,{variant:"ghost",size:"icon-sm","aria-label":"Regex help",children:"?"})}),e.jsx(Se,{id:"isRegex",checked:T,onCheckedChange:s=>{de(s),y.trim()&&fe(y,s)}})]}),e.jsxs(N,{onClick:Qe,disabled:!y.trim()||!!n.newBanPattern,children:[e.jsx(ms,{className:"size-4 mr-1"}),"Add"]})]})]}),n.newBanPattern&&e.jsx("p",{className:"text-xs text-destructive",children:n.newBanPattern})]})]})]}),u&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-primary text-primary-foreground px-4 py-2 rounded-lg shadow-lg flex items-center gap-3",children:[e.jsx("span",{children:"You have unsaved changes"}),e.jsx(N,{variant:"secondary",size:"sm",onClick:be,disabled:z.isPending,children:"Save Now"})]})]})]})}export{Ps as default};
